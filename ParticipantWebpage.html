<!doctype html>
<html lang="es" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Portal Participantes - Intercambio de Regalos</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="/_sdk/data_sdk.js"></script>
  <style>
        body {
            box-sizing: border-box;
        }
        
        .gift-animation {
            animation: giftFloat 3s ease-in-out infinite;
        }
        
        @keyframes giftFloat {
            0%, 100% {
                transform: translateY(0px) rotate(0deg);
            }
            50% {
                transform: translateY(-10px) rotate(5deg);
            }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .success-animation {
            animation: successBounce 0.6s ease-in-out;
        }
        
        @keyframes successBounce {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .shake-animation {
            animation: shake 0.5s ease-in-out;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        .loading-spinner {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .participant-card {
            background: linear-gradient(135deg, #059669 0%, #0d9488 100%);
            box-shadow: 0 25px 50px rgba(0,0,0,0.15);
        }
        
        .assignment-card {
            background: linear-gradient(135deg, #dc2626 0%, #ea580c 100%);
            box-shadow: 0 20px 40px rgba(220, 38, 38, 0.2);
        }
        
        .sparkle {
            animation: sparkle 2s ease-in-out infinite;
        }
        
        @keyframes sparkle {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.2); }
        }
        
        .pulse-glow {
            animation: pulseGlow 2s ease-in-out infinite;
        }
        
        @keyframes pulseGlow {
            0%, 100% { box-shadow: 0 0 20px rgba(34, 197, 94, 0.3); }
            50% { box-shadow: 0 0 40px rgba(34, 197, 94, 0.6); }
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body class="h-full bg-gradient-to-br from-green-50 to-red-50 font-sans">
  <div class="min-h-full flex flex-col"><!-- Participant Login Section -->
   <div id="participant-login-section" class="min-h-full flex items-center justify-center px-6 py-12">
    <div class="max-w-md w-full"><!-- Header -->
     <div class="text-center mb-8">
      <div class="gift-animation inline-block text-8xl mb-4">
       üéÅ
      </div>
      <h1 id="portal-title" class="text-4xl font-bold text-gray-900 mb-2">Portal Participantes</h1>
      <h2 id="event-name" class="text-xl text-gray-600 mb-4">Intercambio Navide√±o 2025</h2><!-- Decorative elements -->
      <div class="flex justify-center items-center gap-2 mb-6"><span class="text-2xl sparkle">‚ú®</span> <span class="text-lg">„Éª</span> <span class="text-2xl gift-animation">üéÑ</span> <span class="text-lg">„Éª</span> <span class="text-2xl sparkle">‚≠ê</span>
      </div>
     </div><!-- Participant Login Card -->
     <div class="participant-card rounded-2xl p-8 text-white shadow-2xl">
      <div class="text-center mb-6">
       <div class="text-5xl mb-4">
        üë§
       </div>
       <h3 class="text-2xl font-bold mb-2">Acceso de Participante</h3>
       <p id="welcome-message" class="text-sm opacity-90">¬°Bienvenido al Portal de Participantes!</p>
      </div>
      <form id="participant-login-form" class="space-y-4">
       <div><label for="participant-username" class="block text-sm font-medium mb-2 opacity-90">Usuario</label> <input type="text" id="participant-username" name="participant-username" required class="w-full px-4 py-3 rounded-lg bg-white bg-opacity-90 border border-white border-opacity-30 text-gray-800 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-white focus:ring-opacity-50 focus:bg-white" placeholder="Tu usuario asignado">
       </div>
       <div><label for="participant-password" class="block text-sm font-medium mb-2 opacity-90">Contrase√±a</label> <input type="password" id="participant-password" name="participant-password" required class="w-full px-4 py-3 rounded-lg bg-white bg-opacity-90 border border-white border-opacity-30 text-gray-800 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-white focus:ring-opacity-50 focus:bg-white" placeholder="Tu contrase√±a temporal">
       </div><button type="submit" id="participant-login-btn" class="w-full bg-white text-green-600 font-bold py-3 px-6 rounded-lg transition-all duration-200 transform hover:scale-105 hover:shadow-lg"> <span class="flex items-center justify-center gap-2"> <span class="text-xl">üéÅ</span> <span id="login-button-text">Acceder a Mi Asignaci√≥n</span> </span> </button>
      </form><!-- Participant Error Message -->
      <div id="participant-error-message" class="mt-4 p-3 bg-red-500 bg-opacity-20 border border-red-300 border-opacity-30 rounded-lg text-center text-sm hidden"><span class="mr-2">‚ùå</span> <span>Credenciales incorrectas. Verifica tu usuario y contrase√±a.</span>
      </div>
     </div><!-- Help Section -->
     <div class="mt-8 bg-white rounded-lg p-6 shadow-md">
      <div class="text-center">
       <div class="text-3xl mb-3">
        üí°
       </div>
       <h4 class="font-bold text-gray-800 mb-2">¬øNecesitas ayuda?</h4>
       <p class="text-sm text-gray-600 mb-3">Si no tienes tus credenciales de acceso, contacta al organizador del evento.</p>
       <div class="text-xs text-gray-500">
        <p>‚Ä¢ Tu usuario y contrase√±a fueron proporcionados por el organizador</p>
        <p>‚Ä¢ Una vez que ingreses, podr√°s ver tu asignaci√≥n de regalo</p>
       </div>
      </div>
     </div><!-- Portal Navigation -->
     <div class="mt-6 text-center"><a href="#" onclick="openAdminPortal()" class="inline-flex items-center gap-2 text-green-600 hover:text-green-800 transition-colors"> <span class="text-lg">üîß</span> <span class="text-sm font-medium">Portal Administrador</span> </a>
     </div>
    </div>
   </div><!-- Participant Dashboard -->
   <div id="participant-dashboard" class="hidden min-h-full flex flex-col"><!-- Header -->
    <header class="bg-gradient-to-r from-green-600 to-red-600 text-white shadow-lg">
     <div class="max-w-4xl mx-auto px-6 py-6">
      <div class="flex items-center justify-between">
       <div class="flex items-center">
        <div class="text-4xl mr-4 gift-animation">
         üéÅ
        </div>
        <div>
         <h1 class="text-3xl font-bold">Mi Intercambio de Regalos</h1>
         <p class="text-lg opacity-90">Descubre tu asignaci√≥n especial</p>
        </div>
       </div>
       <div class="flex items-center gap-4">
        <div class="text-right">
         <p class="text-sm opacity-75">Participante</p>
         <p id="logged-user-name" class="font-semibold">Usuario</p>
        </div><button id="participant-logout-btn" class="bg-white bg-opacity-10 hover:bg-opacity-20 rounded-lg px-4 py-2 border border-white border-opacity-30 transition-all duration-200"> <span class="flex items-center gap-2 text-sm"> <span>üö™</span> <span>Cerrar Sesi√≥n</span> </span> </button>
       </div>
      </div><!-- Portal Navigation -->
      <div class="mt-4 pt-4 border-t border-white border-opacity-30">
       <div class="flex justify-center items-center gap-4">
        <div class="bg-white bg-opacity-20 rounded-lg px-4 py-2 border border-white border-opacity-30">
         <div class="flex items-center gap-2 text-sm"><span class="text-lg">üë§</span> <span class="font-medium">Portal Participantes</span> <span class="text-xs opacity-75">(Actual)</span>
         </div>
        </div>
        <div class="text-white opacity-60">
         ‚ÜîÔ∏è
        </div><a href="#" onclick="openAdminPortal()" class="bg-white bg-opacity-10 hover:bg-opacity-20 rounded-lg px-4 py-2 border border-white border-opacity-30 transition-all duration-200 hover:scale-105">
         <div class="flex items-center gap-2 text-sm"><span class="text-lg">üîß</span> <span class="font-medium">Portal Administrador</span>
         </div></a>
       </div>
      </div>
     </div>
    </header><!-- Main Content -->
    <main class="flex-1 max-w-4xl mx-auto px-6 py-8 w-full"><!-- Assignment Status -->
     <div id="assignment-status" class="mb-8"><!-- Content will be populated by JavaScript -->
     </div><!-- Assignment Card -->
     <div id="assignment-card" class="hidden">
      <div class="assignment-card rounded-2xl p-8 text-white shadow-2xl pulse-glow mb-8">
       <div class="text-center">
        <div class="text-6xl mb-6 gift-animation">
         üéØ
        </div>
        <h3 id="assignment-title" class="text-3xl font-bold mb-4">Tu Asignaci√≥n de Regalo</h3>
        <div class="bg-white bg-opacity-20 rounded-xl p-6 mb-6">
         <div class="text-5xl mb-4">
          üéÅ
         </div>
         <h4 class="text-2xl font-bold mb-2">Debes regalar a:</h4>
         <p id="assigned-person-name" class="text-4xl font-bold mb-2">Nombre de la Persona</p>
         <p id="assigned-person-email" class="text-lg opacity-90">email@ejemplo.com</p>
        </div><!-- Gift Ideas Section -->
        <div class="bg-white bg-opacity-10 rounded-xl p-6">
         <div class="text-3xl mb-3">
          üí°
         </div>
         <h4 class="text-xl font-bold mb-3">Ideas para tu Regalo</h4>
         <div class="grid md:grid-cols-2 gap-4 text-sm">
          <div class="bg-white bg-opacity-10 rounded-lg p-3"><span class="text-lg mr-2">üìö</span> <span>Libros o revistas</span>
          </div>
          <div class="bg-white bg-opacity-10 rounded-lg p-3"><span class="text-lg mr-2">‚òï</span> <span>Caf√© o t√© especial</span>
          </div>
          <div class="bg-white bg-opacity-10 rounded-lg p-3"><span class="text-lg mr-2">üß∏</span> <span>Art√≠culos decorativos</span>
          </div>
          <div class="bg-white bg-opacity-10 rounded-lg p-3"><span class="text-lg mr-2">üç´</span> <span>Dulces o chocolates</span>
          </div>
         </div>
        </div>
       </div>
      </div>
     </div><!-- Event Info -->
     <div class="bg-white rounded-lg shadow-md p-6">
      <div class="text-center">
       <div class="text-4xl mb-4">
        üéÑ
       </div>
       <h3 class="text-2xl font-bold text-gray-800 mb-4">Informaci√≥n del Evento</h3>
       <div class="grid md:grid-cols-2 gap-6">
        <div class="bg-green-50 rounded-lg p-4">
         <div class="text-2xl mb-2">
          üìÖ
         </div>
         <h4 class="font-semibold text-gray-800 mb-1">Fecha del Intercambio</h4>
         <p class="text-gray-600">Por confirmar con el organizador</p>
        </div>
        <div class="bg-red-50 rounded-lg p-4">
         <div class="text-2xl mb-2">
          üí∞
         </div>
         <h4 class="font-semibold text-gray-800 mb-1">Presupuesto Sugerido</h4>
         <p class="text-gray-600">Consulta con el organizador</p>
        </div>
       </div>
       <div class="mt-6 p-4 bg-yellow-50 rounded-lg border border-yellow-200">
        <div class="text-2xl mb-2">
         ‚ö†Ô∏è
        </div>
        <h4 class="font-semibold text-gray-800 mb-2">Recordatorio Importante</h4>
        <p class="text-sm text-gray-600">Mant√©n en secreto tu asignaci√≥n. ¬°La sorpresa es parte de la diversi√≥n del intercambio!</p>
       </div>
      </div>
     </div>
    </main><!-- Footer -->
    <footer class="bg-gray-800 text-white py-6">
     <div class="max-w-4xl mx-auto px-6 text-center">
      <div class="flex justify-center items-center gap-2 mb-2"><span class="sparkle">‚ú®</span> <span class="gift-animation">üéÅ</span> <span class="sparkle">üéÑ</span> <span class="gift-animation">üéØ</span> <span class="sparkle">‚≠ê</span>
      </div>
      <p class="text-gray-300">Portal de Participantes - Intercambio de Regalos 2025</p>
      <p class="text-xs text-gray-400 mt-1">¬°Que disfrutes tu intercambio!</p>
     </div>
    </footer>
   </div>
  </div>
  <script>
        // Configuration
        const defaultConfig = {
            portal_title: "Portal Participantes - Intercambio de Regalos",
            event_name: "Intercambio Navide√±o 2025",
            welcome_message: "¬°Bienvenido al Portal de Participantes!",
            login_button_text: "Acceder a Mi Asignaci√≥n",
            assignment_title: "Tu Asignaci√≥n de Regalo",
            background_color: "#f0fdf4",
            primary_color: "#059669",
            secondary_color: "#dc2626",
            text_color: "#374151",
            surface_color: "#ffffff"
        };

        let participants = [];
        let currentUser = null;
        let isLoggedIn = false;

        // Data SDK Handler
        const dataHandler = {
            onDataChanged(data) {
                participants = data || [];
                updateAssignmentStatus();
            }
        };

        // Portal navigation
        function openAdminPortal() {
            // Reemplaza esta URL con la URL real de tu portal admin publicado
            window.open('TU_URL_PORTAL_ADMIN_AQUI', '_blank');
        }

        // Participant login handler
        document.getElementById('participant-login-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const username = formData.get('participant-username').trim();
            const password = formData.get('participant-password').trim();
            
            // Find participant
            const participant = participants.find(p => 
                p.username === username && p.password === password
            );
            
            if (participant) {
                currentUser = participant;
                isLoggedIn = true;
                showParticipantDashboard();
                showMessage("¬°Acceso exitoso! Bienvenido a tu portal.", "success");
            } else {
                showParticipantLoginError();
                showMessage("Credenciales incorrectas. Verifica tu usuario y contrase√±a.", "error");
            }
        });

        // Participant logout handler
        document.getElementById('participant-logout-btn').addEventListener('click', () => {
            currentUser = null;
            isLoggedIn = false;
            showParticipantLogin();
            showMessage("Sesi√≥n cerrada correctamente.", "info");
        });

        // Show participant login
        function showParticipantLogin() {
            document.getElementById('participant-login-section').classList.remove('hidden');
            document.getElementById('participant-dashboard').classList.add('hidden');
            
            // Clear form
            document.getElementById('participant-login-form').reset();
            document.getElementById('participant-error-message').classList.add('hidden');
        }

        // Show participant dashboard
        function showParticipantDashboard() {
            document.getElementById('participant-login-section').classList.add('hidden');
            document.getElementById('participant-dashboard').classList.remove('hidden');
            
            // Update user info
            document.getElementById('logged-user-name').textContent = currentUser.name;
            
            updateAssignmentStatus();
        }

        // Show participant login error
        function showParticipantLoginError() {
            const errorDiv = document.getElementById('participant-error-message');
            const loginForm = document.getElementById('participant-login-form');
            
            errorDiv.classList.remove('hidden');
            loginForm.classList.add('shake-animation');
            
            setTimeout(() => {
                loginForm.classList.remove('shake-animation');
            }, 500);
        }

        // Update assignment status
        function updateAssignmentStatus() {
            if (!isLoggedIn || !currentUser) return;
            
            const statusContainer = document.getElementById('assignment-status');
            const assignmentCard = document.getElementById('assignment-card');
            
            if (currentUser.assignedTo && currentUser.assignedToEmail) {
                // Show assignment
                statusContainer.innerHTML = `
                    <div class="bg-green-100 border border-green-300 rounded-lg p-6 text-center">
                        <div class="text-4xl mb-3 success-animation">‚úÖ</div>
                        <h3 class="text-xl font-bold text-green-800 mb-2">¬°Tu Asignaci√≥n Est√° Lista!</h3>
                        <p class="text-green-700">El sorteo se ha completado y ya tienes tu asignaci√≥n de regalo.</p>
                    </div>
                `;
                
                // Update assignment card
                document.getElementById('assigned-person-name').textContent = currentUser.assignedTo;
                document.getElementById('assigned-person-email').textContent = currentUser.assignedToEmail;
                
                assignmentCard.classList.remove('hidden');
            } else {
                // No assignment yet
                statusContainer.innerHTML = `
                    <div class="bg-yellow-100 border border-yellow-300 rounded-lg p-6 text-center">
                        <div class="text-4xl mb-3">‚è≥</div>
                        <h3 class="text-xl font-bold text-yellow-800 mb-2">Esperando el Sorteo</h3>
                        <p class="text-yellow-700 mb-4">El organizador a√∫n no ha realizado el sorteo. Tu asignaci√≥n aparecer√° aqu√≠ una vez que est√© lista.</p>
                        <div class="bg-white rounded-lg p-4 inline-block">
                            <div class="flex items-center gap-2 text-sm text-gray-600">
                                <span class="loading-spinner w-4 h-4 border-2 border-yellow-500 border-t-transparent rounded-full"></span>
                                <span>Verificando actualizaciones...</span>
                            </div>
                        </div>
                    </div>
                `;
                
                assignmentCard.classList.add('hidden');
            }
        }

        // Show message
        function showMessage(message, type) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 fade-in ${
                type === 'success' ? 'bg-green-100 text-green-800 border border-green-200' :
                type === 'error' ? 'bg-red-100 text-red-800 border border-red-200' :
                'bg-blue-100 text-blue-800 border border-blue-200'
            }`;
            messageDiv.textContent = message;
            
            document.body.appendChild(messageDiv);
            
            setTimeout(() => {
                messageDiv.remove();
            }, 4000);
        }

        // Element SDK Configuration
        async function onConfigChange(config) {
            document.getElementById('portal-title').textContent = config.portal_title || defaultConfig.portal_title;
            document.getElementById('event-name').textContent = config.event_name || defaultConfig.event_name;
            document.getElementById('welcome-message').textContent = config.welcome_message || defaultConfig.welcome_message;
            document.getElementById('login-button-text').textContent = config.login_button_text || defaultConfig.login_button_text;
            document.getElementById('assignment-title').textContent = config.assignment_title || defaultConfig.assignment_title;
            
            // Apply colors
            const backgroundColor = config.background_color || defaultConfig.background_color;
            const primaryColor = config.primary_color || defaultConfig.primary_color;
            const secondaryColor = config.secondary_color || defaultConfig.secondary_color;
            const textColor = config.text_color || defaultConfig.text_color;
            const surfaceColor = config.surface_color || defaultConfig.surface_color;
            
            document.body.style.background = `linear-gradient(to bottom right, ${backgroundColor}, #fef2f2)`;
            
            // Update header gradient
            const header = document.querySelector('header');
            if (header) {
                header.style.background = `linear-gradient(to right, ${primaryColor}, ${secondaryColor})`;
            }
            
            // Update participant card gradient
            const participantCard = document.querySelector('.participant-card');
            if (participantCard) {
                participantCard.style.background = `linear-gradient(135deg, ${primaryColor} 0%, #0d9488 100%)`;
            }
            
            // Update assignment card gradient
            const assignmentCard = document.querySelector('.assignment-card');
            if (assignmentCard) {
                assignmentCard.style.background = `linear-gradient(135deg, ${secondaryColor} 0%, #ea580c 100%)`;
            }
            
            // Update text colors
            const textElements = document.querySelectorAll('h1, h2, h3, h4, p, label');
            textElements.forEach(el => {
                if (!el.classList.contains('text-white') && !el.classList.contains('text-gray-300')) {
                    el.style.color = textColor;
                }
            });
            
            // Update surface colors
            const surfaces = document.querySelectorAll('.bg-white');
            surfaces.forEach(surface => {
                surface.style.backgroundColor = surfaceColor;
            });
        }

        function mapToCapabilities(config) {
            return {
                recolorables: [
                    {
                        get: () => config.background_color || defaultConfig.background_color,
                        set: (value) => {
                            config.background_color = value;
                            if (window.elementSdk) {
                                window.elementSdk.setConfig({ background_color: value });
                            }
                        }
                    },
                    {
                        get: () => config.surface_color || defaultConfig.surface_color,
                        set: (value) => {
                            config.surface_color = value;
                            if (window.elementSdk) {
                                window.elementSdk.setConfig({ surface_color: value });
                            }
                        }
                    },
                    {
                        get: () => config.text_color || defaultConfig.text_color,
                        set: (value) => {
                            config.text_color = value;
                            if (window.elementSdk) {
                                window.elementSdk.setConfig({ text_color: value });
                            }
                        }
                    },
                    {
                        get: () => config.primary_color || defaultConfig.primary_color,
                        set: (value) => {
                            config.primary_color = value;
                            if (window.elementSdk) {
                                window.elementSdk.setConfig({ primary_color: value });
                            }
                        }
                    },
                    {
                        get: () => config.secondary_color || defaultConfig.secondary_color,
                        set: (value) => {
                            config.secondary_color = value;
                            if (window.elementSdk) {
                                window.elementSdk.setConfig({ secondary_color: value });
                            }
                        }
                    }
                ],
                borderables: [],
                fontEditable: undefined,
                fontSizeable: undefined
            };
        }

        function mapToEditPanelValues(config) {
            return new Map([
                ["portal_title", config.portal_title || defaultConfig.portal_title],
                ["event_name", config.event_name || defaultConfig.event_name],
                ["welcome_message", config.welcome_message || defaultConfig.welcome_message],
                ["login_button_text", config.login_button_text || defaultConfig.login_button_text],
                ["assignment_title", config.assignment_title || defaultConfig.assignment_title]
            ]);
        }

        // Initialize SDKs
        async function initializeApp() {
            // Initialize Element SDK
            if (window.elementSdk) {
                window.elementSdk.init({
                    defaultConfig,
                    onConfigChange,
                    mapToCapabilities,
                    mapToEditPanelValues
                });
            }
            
            // Initialize Data SDK
            if (window.dataSdk) {
                const result = await window.dataSdk.init(dataHandler);
                if (!result.isOk) {
                    console.error("Failed to initialize Data SDK");
                }
            }
        }

        // Initialize app when page loads
        initializeApp();
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9a2296e6a7afe79f',t:'MTc2Mzc1MzI5OS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
